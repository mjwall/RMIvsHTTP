<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="RMIvsHTTP : A project to test performance of EJB with different communication protocols" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

      <title>RMIvsHTTP</title>

      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <script src="javascripts/highcharts.js" type="text/javascript"></script>
    </head>

    <body>

      <!-- HEADER -->
      <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mjwall/RMIvsHTTP">Fork Me on GitHub</a>

          <h1 id="project_title">RMIvsHTTP</h1>
          <h2 id="project_tagline">A project to test performance of EJB with different communication protocols</h2>

          <section id="downloads">
            <a class="zip_download_link" href="https://github.com/mjwall/RMIvsHTTP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/mjwall/RMIvsHTTP/tarball/master">Download this project as a tar.gz file</a>
          </section>
        </header>
      </div>

      <!-- MAIN CONTENT -->
      <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
          <h1>RMI vs HTTP</h1>

          <h2>Purpose</h2>

          <p>The purpose of this project is to test the performance of EJB communication vs
          exposing the EJB as a service and communication over HTTP/HTTPS</p>

          <h2>Design</h2>

          <h3>Code under Test</h3>

          <p>The code under test is 2 EJBs and a WAR. The first EJB has a method that simply adds one to the input. The REST EJB gets a reference to the first EJB and exposes it's method via RESTEasy. The WAR file simple exposes the REST EJB and serializes the response to XML. Typically, this setup would go into an EAR, but I choose to deploy them separately.</p>

          <p>Here is a diagram of the interactions in code</p>
          <img src="images/CodeUnderTest.png" alt="Code under test" />

          <h3>Test design</h3>

          <p>There are five test scenarios listed below with graphics to help explain the interactions</p>

          <ol>
            <li>
              RMI using a local interface to the REST EJB, obviously the same JVM
              <img src="images/LocalTestSameJVM.png" />
            </li>
            <li>
              RMI using a remote interface to the REST EJB on the same JVM
              <img src="images/RemoteTestSameJVM.png" />
            </li>
            <li>
              RMI using a remote interface to the REST EJB on a different JVM
              <img src="images/RemoteTestExternalJVM.png" />
            </li>
            <li>
              HTTP calling the exposed REST endpoint from the REST EJB
              <img src="images/HTTPTest.png" />
            </li>
            <li>
              HTTPS calling the exposed REST endpoint from the REST EJB
              <img src="images/HTTPSTest.png" />
            </li>
          </ol>

          <p>The tests run on the same machine, so there is no network latency. In practice, the network will decrease the performance if the remote interface is called from a different machine or if the HTTP client is located on a different server.<p>

          <h2>Project page</h2>

          <p> If you want more info about the design, or would like to run this for yourself, please refer to the project page on github at <a href="https://www.github.com/mjwall/RMIvsHTTP">www.github.com/mjwall/RMIvsHTTP</a>
          </p>

          <h2>Results</h2>

          <p>The five scenarios where run 30 times each with 10, 100, 1,000, 10,000 and 100,000 executions per run.  That's right, I added one to a number 16,666,500 times.  100,000 took over 3 hours to complete.  I tried 1,000,000 executions per run, but my poor laptop gave up.</p>

          <h3>Data</h3>

          <p>The following table displays the average executions per second for each scenario.  The raw tdata is available by clicking on a number, if you really want to dig through.</p>

          <table>
            <caption>Numbers are executions/second</caption>
            <thead>
            <tr>
              <th>Scenario</th>
              <th>10 executions/run</th>
              <th>100 executions/run</th>
              <th>1000 executions/run</th>
              <th>10000 executions/run</th>
              <th>100000 executions/run</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>Local same JVM</td>
              <td><a href="data/10-local-same.txt" target="_blank">5000</a></td>
              <td><a href="data/100-local-same.txt" target="_blank">5263.16</a></td>
              <td><a href="data/1000-local-same.txt" target="_blank">5319.15</a></td>
              <td><a href="data/10000-local-same.txt" target="_blank">5270.57</a></td>
              <td><a href="data/100000-local-same.txt" target="_blank">5099.96</a></td>
            </tr>
            <tr>
              <td>Remote same JVM</td>
              <td><a href="data/10-remote-same.txt" target="_blank">3333.33</a></td>
              <td><a href="data/100-remote-same.txt" target="_blank">3225.81</a></td>
              <td><a href="data/1000-remote-same.txt" target="_blank">3289.47</a></td>
              <td><a href="data/10000-remote-same.txt" target="_blank">3195.91</a></td>
              <td><a href="data/100000-remote-same.txt" target="_blank">3252.67</a></td>
            </tr>
            <tr>
              <td>Remote external JVM</td>
              <td><a href="data/10-remote-external.txt" target="_blank">322.58</a></td>
              <td><a href="data/100-remote-external.txt" target="_blank">469.48</a></td>
              <td><a href="data/1000-remote-external.txt" target="_blank">624.61</a></td>
              <td><a href="data/10000-remote-external.txt" target="_blank">525.60</a></td>
              <td><a href="data/100000-remote-external.txt" target="_blank">528.77</a></td>
            </tr>
            <tr>
              <td>HTTP</td>
              <td><a href="data/10-http.txt" target="_blank">181.81</a></td>
              <td><a href="data/100-http.txt" target="_blank">286.53</a></td>
              <td><a href="data/1000-http.txt" target="_blank">348.19</a></td>
              <td><a href="data/10000-http.txt" target="_blank">358.94</a></td>
              <td><a href="data/100000-http.txt" target="_blank">369.58</a></td>
            </tr>
            <tr>
              <td>HTTPS</td>
              <td><a href="data/10-https.txt" target="_blank">185.19</a></td>
              <td><a href="data/100-https.txt" target="_blank">271.00</a></td>
              <td><a href="data/1000-https.txt" target="_blank">333.11</a></td>
              <td><a href="data/10000-https.txt" target="_blank">343.96</a></td>
              <td><a href="data/100000-https.txt" target="_blank">352.61</a></td>
            </tr>
            </tbody>
          </table>

          <h3>Chart</h3>

          <p>The following chart summarizes my test results shown in the table above.  The chart is interactive, so mouse over the lines and click the legend.  It is hard to see the difference between HTTP and HTTPS,, so click on the local and both remotes in the legend on the chart to zoom in.</p>

          <div id="graph-container" style="width: 100%; height: 400px"></div>
          <script type="text/javascript">
            var chart1; // globally available
   $(document).ready(function() {
      chart1 = new Highcharts.Chart({
         chart: {
            renderTo: 'graph-container',
            type: 'line'
         },
         title: {
            text: 'Computations per second'
         },
         xAxis: {
            categories: ['10', '100','1000', '10000', '100000']
         },
         yAxis: {
            title: {
               text: 'Time (ms)'
            }
         },
         series: [{
            name: 'local same JVM',
            data: [5000, 5263.16, 5319.15, 5270.57, 5099.96]
         }, {
            name: 'remote same JVM',
            data: [3333.33, 3225.81, 3289.47, 3195.91, 3252.67]
         }, {
            name: 'remote external JVM',
            data: [322.58, 469.48, 624.61, 525.60, 528.77]
         }, {
            name: 'http',
            data: [181.81, 286.53, 348.19, 358.94, 369.58]
         }, {
            name: 'https',
            data: [185.19, 271.00, 333.11, 343.96, 352.61]
         }
         ]
      });
   });
          </script>

          <h3>Conclusion</h3>

          <p>My intent was to make this a realistic experiment, but there are a couple of things missing.  One, there is relatively little network latency as this was run on one box.  That will only decrease the performance for remote-external, http and https.  Second, the XML reponse from the RESTEasy service is small.  If you are passing back a large amount of data, parsing the bigger XML will decrease performance for http and https.  Based on these numbers alone, I'll make the following broad statements.</p>

          <ul>
            <li>
              Local invocation of an EJB is 15-25 times faster than either HTTP or HTTPS.
            </li>
            <li>
              Using the local interface on the same JVM is roughly 1.5 times faster than using the remote interface on the same JVM.
            </li>
            <li>
              Remote interface on the same JVM is 6-10 times faster than remote interface on a seperate JVM.  Some of this may be due to fact that I had to pull in the jboss-as-client package to run in a different JVM.  That package was huge.
            </li>
            <li>
              Remote interface on an external JVM is 1.5-1.7 times faster than HTTP or HTTPS.
            </li>
            <li>
              HTTP and HTTPS are roughly equivalent.
            </li>
            <li>
              Executions per second generally went up as I increased the executions per run.  Not sure exactly why, but I'll attribute it hotspot, jboss caching and a startup cost on the first run in each test.
            </li>
          </ul>

        <p>Thanks for reading this.  I am tired of looking at it</p>

        </section>
        <div>

          <!-- FOOTER  -->
          <div id="footer_wrap" class="outer">
            <footer class="inner">
              <p class="copyright">RMIvsHTTP maintained by <a href="https://github.com/mjwall">mjwall</a></p>
              <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
            </footer>
          </div>



        </body>
      </html>
